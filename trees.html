

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Trees &mdash; py_trees 0.5.8 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="py_trees 0.5.8 documentation" href="index.html"/>
        <link rel="next" title="Visualisation" href="visualisation.html"/>
        <link rel="prev" title="Blackboards" href="blackboards.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> py_trees
          

          
          </a>

          
            
            
              <div class="version">
                0.5.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
                <p class="caption"><span class="caption-text">Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="behaviours.html">Behaviours</a></li>
<li class="toctree-l1"><a class="reference internal" href="composites.html">Composites</a></li>
<li class="toctree-l1"><a class="reference internal" href="blackboards.html">Blackboards</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">Trees</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-behaviour-tree">The Behaviour Tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="#skeleton">Skeleton</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pre-post-tick-handlers">Pre/Post Tick Handlers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visitors">Visitors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="visualisation.html">Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="the_crazy_hospital.html">Surviving the Crazy Hospital</a></li>
<li class="toctree-l1"><a class="reference internal" href="terminology.html">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">FAQ</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="demos.html">Demos</a></li>
<li class="toctree-l1"><a class="reference internal" href="programs.html">Programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Module API</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

            
          
    <a href="genindex.html">Index</a>
    <a href="py-modindex.html">Module Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">py_trees</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Trees</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/trees.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="trees">
<h1>Trees<a class="headerlink" href="#trees" title="Permalink to this headline">¶</a></h1>
<p>While a graph of connected behaviours and composites form a tree in their own right
(i.e. it can be initialised and ticked), it is usually convenient to wrap your tree
in another class to take care of alot of the housework and provide some extra bells
and whistles that make your tree flourish.</p>
<a class="reference internal image-reference" href="_images/yggdrasil.jpg"><img alt="_images/yggdrasil.jpg" class="align-center" src="_images/yggdrasil.jpg" style="width: 200px;" /></a>
<p>This package provides a default reference implementation that is directly usable, but
can also be easily used as inspiration for your own tree custodians.</p>
<div class="section" id="the-behaviour-tree">
<h2>The Behaviour Tree<a class="headerlink" href="#the-behaviour-tree" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt>
<em class="property">class </em><code class="descclassname">py_trees.trees.</code><code class="descname">BehaviourTree</code><span class="sig-paren">(</span><em>root</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/py_trees/trees.html#BehaviourTree"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Grow, water, prune your behaviour tree with this, the default reference
implementation. It features a few enhancements to provide richer logging,
introspection and dynamic management of the tree itself:</p>
<ul class="simple">
<li>Pre and post tick handlers to execute code automatically before and after a tick</li>
<li>Visitor access to the parts of the tree that were traversed in a tick</li>
<li>Subtree pruning and insertion operations</li>
<li>Continuous tick-tock support</li>
</ul>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">The <a class="reference internal" href="demos.html#py-trees-demo-tree-stewardship-program"><span>py-trees-demo-tree-stewardship</span></a> program demonstrates the above features.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>root</strong> (<a class="reference internal" href="modules.html#py_trees.behaviour.Behaviour" title="py_trees.behaviour.Behaviour"><code class="xref py py-class docutils literal"><span class="pre">Behaviour</span></code></a>) &#8211; root node of the tree</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Variables:</th><td class="field-body"><ul class="first simple">
<li><strong>count</strong> (<code class="xref py py-obj docutils literal"><span class="pre">int</span></code>) &#8211; number of times the tree has been ticked.</li>
<li><strong>root</strong> (<a class="reference internal" href="modules.html#py_trees.behaviour.Behaviour" title="py_trees.behaviour.Behaviour"><code class="xref py py-class docutils literal"><span class="pre">Behaviour</span></code></a>) &#8211; root node of the tree</li>
<li><a class="reference internal" href="modules.html#module-py_trees.visitors" title="py_trees.visitors: entities that visit behaviours as a tree is traversed"><strong>visitors</strong></a> ([<a class="reference internal" href="modules.html#module-py_trees.visitors" title="py_trees.visitors: entities that visit behaviours as a tree is traversed"><code class="xref py py-mod docutils literal"><span class="pre">visitors</span></code></a>]) &#8211; entities that visit traversed parts of the tree when it ticks</li>
<li><strong>pre_tick_handlers</strong> ([<code class="xref py py-obj docutils literal"><span class="pre">func</span></code>]) &#8211; functions that run before the entire tree is ticked</li>
<li><strong>post_tick_handlers</strong> ([<code class="xref py py-obj docutils literal"><span class="pre">func</span></code>]) &#8211; functions that run after the entire tree is ticked</li>
</ul>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Raises:</th><td class="field-body"><p class="first last"><code class="xref py py-exc docutils literal"><span class="pre">AssertionError</span></code> &#8211;
if incoming root variable is not the correct type</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="skeleton">
<h2>Skeleton<a class="headerlink" href="#skeleton" title="Permalink to this headline">¶</a></h2>
<p>The most basic feature of the behaviour tree is it&#8217;s automatic tick-tock. You can
<a class="reference internal" href="modules.html#py_trees.trees.BehaviourTree.tick_tock" title="py_trees.trees.BehaviourTree.tick_tock"><code class="xref py py-meth docutils literal"><span class="pre">tick_tock()</span></code></a> for a specific number of iterations,
or indefinitely and use the <a class="reference internal" href="modules.html#py_trees.trees.BehaviourTree.interrupt" title="py_trees.trees.BehaviourTree.interrupt"><code class="xref py py-meth docutils literal"><span class="pre">interrupt()</span></code></a> method to stop it.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span class="ch">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">py_trees</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>

    <span class="n">root</span> <span class="o">=</span> <span class="n">py_trees</span><span class="o">.</span><span class="n">composites</span><span class="o">.</span><span class="n">Selector</span><span class="p">(</span><span class="s2">&quot;Selector&quot;</span><span class="p">)</span>
    <span class="n">high</span> <span class="o">=</span> <span class="n">py_trees</span><span class="o">.</span><span class="n">behaviours</span><span class="o">.</span><span class="n">Success</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;High Priority&quot;</span><span class="p">)</span>
    <span class="n">med</span> <span class="o">=</span> <span class="n">py_trees</span><span class="o">.</span><span class="n">behaviours</span><span class="o">.</span><span class="n">Success</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Med Priority&quot;</span><span class="p">)</span>
    <span class="n">low</span> <span class="o">=</span> <span class="n">py_trees</span><span class="o">.</span><span class="n">behaviours</span><span class="o">.</span><span class="n">Success</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Low Priority&quot;</span><span class="p">)</span>
    <span class="n">root</span><span class="o">.</span><span class="n">add_children</span><span class="p">([</span><span class="n">high</span><span class="p">,</span> <span class="n">med</span><span class="p">,</span> <span class="n">low</span><span class="p">])</span>

    <span class="n">behaviour_tree</span> <span class="o">=</span> <span class="n">py_trees</span><span class="o">.</span><span class="n">trees</span><span class="o">.</span><span class="n">BehaviourTree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
    <span class="n">behaviour_tree</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">behaviour_tree</span><span class="o">.</span><span class="n">tick_tock</span><span class="p">(</span>
            <span class="n">sleep_ms</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">number_of_iterations</span><span class="o">=</span><span class="n">py_trees</span><span class="o">.</span><span class="n">trees</span><span class="o">.</span><span class="n">CONTINUOUS_TICK_TOCK</span><span class="p">,</span>
            <span class="n">pre_tick_handler</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">post_tick_handler</span><span class="o">=</span><span class="bp">None</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">behaviour_tree</span><span class="o">.</span><span class="n">interrupt</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>or create your own loop and tick at your own leisure with
the <a class="reference internal" href="modules.html#py_trees.trees.BehaviourTree.tick" title="py_trees.trees.BehaviourTree.tick"><code class="xref py py-meth docutils literal"><span class="pre">tick()</span></code></a> method.</p>
</div>
<div class="section" id="pre-post-tick-handlers">
<h2>Pre/Post Tick Handlers<a class="headerlink" href="#pre-post-tick-handlers" title="Permalink to this headline">¶</a></h2>
<p>Pre and post tick handlers can be used to perform some activity on or with the tree
immediately before and after ticking. This is mostly useful with the continuous
<a class="reference internal" href="modules.html#py_trees.trees.BehaviourTree.tick_tock" title="py_trees.trees.BehaviourTree.tick_tock"><code class="xref py py-meth docutils literal"><span class="pre">tick_tock()</span></code></a> mechanism.</p>
<p>This is useful for a variety of purposes:</p>
<ul class="simple">
<li>logging</li>
<li>doing introspection on the tree to make reports</li>
<li>extracting data from the blackboard</li>
<li>triggering on external conditions to modify the tree (e.g. new plan arrived)</li>
</ul>
<p>This can be done of course, without locking since the tree won&#8217;t be ticking while these
handlers run. This does however, mean that your handlers should be light. They will be
consuming time outside the regular tick period.</p>
<p>The <a class="reference internal" href="demos.html#py-trees-demo-tree-stewardship-program"><span>py-trees-demo-tree-stewardship</span></a> program demonstrates a very simple
pre-tick handler that just prints a line to stdout notifying the user of the current run.
The relevant code:</p>
<div class="literal-block-wrapper container" id="pre-tick-handler-function">
<div class="code-block-caption"><span class="caption-text">pre-tick-handler-function</span><a class="headerlink" href="#pre-tick-handler-function" title="Permalink to this code">¶</a></div>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre>

<span class="k">def</span> <span class="nf">pre_tick_handler</span><span class="p">(</span><span class="n">behaviour_tree</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This prints a banner will run immediately before every tick of the tree.</span>

<span class="sd">    Args:</span>
<span class="sd">        behaviour_tree (:class:`~py_trees.trees.BehaviourTree`): the tree custodian</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--------- Run </span><span class="si">%s</span><span class="s2"> ---------</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">behaviour_tree</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="literal-block-wrapper container" id="pre-tick-handler-adding">
<div class="code-block-caption"><span class="caption-text">pre-tick-handler-adding</span><a class="headerlink" href="#pre-tick-handler-adding" title="Permalink to this code">¶</a></div>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre>    <span class="c1"># Rendering</span>
    <span class="c1">####################</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="visitors">
<h2>Visitors<a class="headerlink" href="#visitors" title="Permalink to this headline">¶</a></h2>
<p>Visitors are entities that can be passed to a tree implementation
(e.g. <a class="reference internal" href="modules.html#py_trees.trees.BehaviourTree" title="py_trees.trees.BehaviourTree"><code class="xref py py-class docutils literal"><span class="pre">BehaviourTree</span></code></a>) and used to either visit
each and every behaviour in the tree, or visit behaviours as the tree is
traversed in an executing tick. At each behaviour, the visitor
runs its own method on the behaviour to do as it wishes - logging, introspecting).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Visitors should not modify the behaviours they visit.</p>
</div>
<p>The <a class="reference internal" href="demos.html#py-trees-demo-tree-stewardship-program"><span>py-trees-demo-tree-stewardship</span></a> program demonstrates the two reference
visitor implementations:</p>
<ul class="simple">
<li><a class="reference internal" href="modules.html#py_trees.visitors.DebugVisitor" title="py_trees.visitors.DebugVisitor"><code class="xref py py-class docutils literal"><span class="pre">DebugVisitor</span></code></a> prints debug logging messages to stdout and</li>
<li><a class="reference internal" href="modules.html#py_trees.visitors.SnapshotVisitor" title="py_trees.visitors.SnapshotVisitor"><code class="xref py py-class docutils literal"><span class="pre">SnapshotVisitor</span></code></a> collects runtime data to be used by visualisations</li>
</ul>
<p>Adding visitors to a tree:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">behaviour_tree</span> <span class="o">=</span> <span class="n">py_trees</span><span class="o">.</span><span class="n">trees</span><span class="o">.</span><span class="n">BehaviourTree</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
<span class="n">behaviour_tree</span><span class="o">.</span><span class="n">visitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">py_trees</span><span class="o">.</span><span class="n">visitors</span><span class="o">.</span><span class="n">DebugVisitor</span><span class="p">())</span>
<span class="n">snapshot_visitor</span> <span class="o">=</span> <span class="n">py_trees</span><span class="o">.</span><span class="n">visitors</span><span class="o">.</span><span class="n">SnapshotVisitor</span><span class="p">()</span>
<span class="n">behaviour_tree</span><span class="o">.</span><span class="n">visitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">snapshot_visitor</span><span class="p">)</span>
</pre></div>
</div>
<p>These visitors are automatically run inside the tree&#8217;s <a class="reference internal" href="modules.html#py_trees.trees.BehaviourTree.tick" title="py_trees.trees.BehaviourTree.tick"><code class="xref py py-class docutils literal"><span class="pre">tick</span></code></a> method.
The former immediately logs to screen, the latter collects information which is then used to display an
ascii tree:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">behaviour_tree</span><span class="o">.</span><span class="n">tick</span><span class="p">()</span>
<span class="n">ascii_tree</span> <span class="o">=</span> <span class="n">py_trees</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">ascii_tree</span><span class="p">(</span>
    <span class="n">behaviour_tree</span><span class="o">.</span><span class="n">root</span><span class="p">,</span>
    <span class="n">snapshot_information</span><span class="o">=</span><span class="n">snapshot_visitor</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">ascii_tree</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="visualisation.html" class="btn btn-neutral float-right" title="Visualisation" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="blackboards.html" class="btn btn-neutral" title="Blackboards" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.5.8',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>